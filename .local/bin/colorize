#!/usr/bin/env python

# Substitute pixels in a image file

import matplotlib as mpl
import sys
import os
from PIL import Image

if len(sys.argv) < 3:
    sys.exit('''Usage: 
     colorize substitute replacement

     substitute: Color of pixel to be substituted (as '#RRGGBB')
     replacement: Color of new pixel (as '#RRGGBB')''')

substitute_color = sys.argv[1]
out_color = sys.argv[2]
new_rgb_value = tuple([ int(val * 255) for val in mpl.colors.to_rgb(out_color) ])
    
os.mkdir("changed")
for file in os.listdir()[:2]:

    image = Image.open(file)
    width, height = image.size

    for x in range(width):
        for y in range(height):
            rgba = [ px / 255 for px in image.getpixel((x,y)) ]
            color = mpl.colors.rgb2hex(rgba)

            # Overwrite color of matching pixel
            if color == substitute_color:
                image.putpixel((x,y), new_rgb_value)

    filename, file_ext = file.split('.')
    image.save(f"./changed/{filename}.{file_ext}")
